{% extends "home.html" %}

{% comment %}
# Copyright 2012, hast. All rights reserved.

# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or (at
# your option) any later version.
{% endcomment %}

{% block content %}
<div class="logic-block">
  <h1>{{ object.name }}</h1>
  <div class="panel-button border-bottom">
    {% if user.get_profile in object.followed.all %}
    <a href="{% url course_leave object.slug %}">leave</a>
    {% else %}
    <a href="{% url course_join object.slug %}">join</a>
    {% endif %}
  </div>
  <div class="clear"></div>
  <div class="logic-p">
  {% for line in object.last_info.infos %}
    <strong>{{ line.name }}:</strong> {{ line.value|truncatechars:50 }}<br>
  {% endfor %}
  </div>
</div>

<div class="clear"></div>

<div class="logic-block">
  <h1>Documents</h1>
  <div class="panel-button border-bottom" data-target="upload" data-action="show">
    upload
  </div>
  <div class="clear"></div>

  <div id="upload" class="panel">
    <form action="{% url document_put %}" method="post"
          enctype="multipart/form-data">
      {% csrf_token %}
      <table>
        {{ upload_form.as_table }}
      </table>
      <input type="submit" value="Upload"/>
    </form>
  </div>

  <table class="sortable rounded w700">
    <thead>
      <tr>
        <th class="rounded-left">#</th>
        <th style="min-width: 200px">Name</th>
        <th>Score</th>
        <th>Poster</th>
        <th class="rounded-right">Size</th>
      </tr>
    </thead>
  
    <tbody>
    {% for doc in object.document_set.all %}
      <tr>
        <td>{{ doc.id }}</td>
        <td><a href="{% url document_show doc.id %}">{{ doc.name }}</a></td>
        <td>0</td>
        <td>{{ doc.user.name }}</td>
        <td>{{ doc.pages }}</td>
        </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<div class="clear"></div>

<div class="logic-block">
  <h1>Discussions</h1>
  <div class="panel-button border-bottom" data-target="post" data-action="show">
    new post
  </div>
  <div class="clear"></div>

  <div id="post" class="panel">
    <form action="{% url thread_put %}" method="post">
      {% csrf_token %}
      <table>
        {{ newthread_form.as_table }}
      </table>
      <input type="submit" value="Post"/>
    </form>
  </div>

  <table class="sortable rounded w700">
    <thead>
      <tr>
        <th>#</th>
        <th style="min-width: 200px">Subject</th>
        <th>Poster</th>
        <th>Date</th>
      </tr>
    </thead>
  
    <tbody>
    {% for thread in object.thread_set %}
      <tr>
        <td>{{ thread.id }}</td>
        <td><a href="{% url thread_show thread.id %}">{{ thread.name }}</a></td>
        <td>{{ thread.user.name }}</td>
        <td>{{ thread.created }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<div class="clear"></div>
{% endblock %}
